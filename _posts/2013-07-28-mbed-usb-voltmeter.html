---
layout: post
title: mbed USB voltmeter
date: '2013-07-28T20:52:00.000+02:00'
author: Sakis Kasampallis
tags:
- voltmeter
- c++
- mbed
- USB
- communication
- embedded system
- LPC1768
modified_time: '2014-04-12T12:55:48.339+02:00'
blogger_id: tag:blogger.com,1999:blog-7146248794813174249.post-1029966645366718286
blogger_orig_url: http://sakiskasampalis.blogspot.com/2013/07/mbed-usb-voltmeter.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">USB communication with mbed is easy. That's because USB is the default protocol used to transfer programs from a computer to an mbed.<br /><br />In this prototype I measure the analog value of a pot, I convert it to  voltage, and finally I use USB to print it on my computer's  screen. That's a simplistic voltage meter! Here's the schematic:<br /><br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-zjXcdWLTPi8/UfVJyejZJTI/AAAAAAAAAG4/g1aEkW9UG1w/s1600/voltmeter-schematic.jpg" style="margin-left: auto; margin-right: auto;"><img border="0" height="207" src="https://images-blogger-opensocial.googleusercontent.com/gadgets/proxy?url=http%3A%2F%2F4.bp.blogspot.com%2F-zjXcdWLTPi8%2FUfVJyejZJTI%2FAAAAAAAAAG4%2Fg1aEkW9UG1w%2Fs1600%2Fvoltmeter-schematic.jpg&amp;container=blogger&amp;gadget=a&amp;rewriteMime=image%2F*" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">USB voltage meter schematic. Image courtesy of Bert Van Dam</td></tr></tbody></table><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-PDXtSfs8K2E/UfQjbnRkuyI/AAAAAAAAAGo/L5tAUyAeiWo/s1600/usb-voltmeter.jpg" style="margin-left: 1em; margin-right: 1em;"><br /></a></div><br />And a picture of the actual circuit:<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-PDXtSfs8K2E/UfQjbnRkuyI/AAAAAAAAAGo/L5tAUyAeiWo/s1600/usb-voltmeter.jpg" style="margin-left: auto; margin-right: auto;"><img border="0" height="640" src="https://images-blogger-opensocial.googleusercontent.com/gadgets/proxy?url=http%3A%2F%2F4.bp.blogspot.com%2F-PDXtSfs8K2E%2FUfQjbnRkuyI%2FAAAAAAAAAGo%2FL5tAUyAeiWo%2Fs1600%2Fusb-voltmeter.jpg&amp;container=blogger&amp;gadget=a&amp;rewriteMime=image%2F*" width="480" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">USB voltage meter circuit</td></tr></tbody></table><div style="text-align: left;"><br />Note that the pot is used just for testing purposes. It can actually be replaced by any other part. Just make sure that you're not trying to measure voltage &gt; 3.3 volts, or your mbed is in danger!</div><h3 style="text-align: left;">The code </h3><div style="text-align: left;">First the header file. It defines the USB connection, the analog input pin used to read the pot's value, a few constants, and a function that will be used for converting the pot's value from [0 - 1] to the voltage [0 - 3.3] volts.</div><br /><script src="https://gist.github.com/faif/6099348.js?file=voltmeter.h"></script><br />And the source file. It contains the body of the conversion function, two terminal control commands for clearing the screen and moving to the top, and the commands for reading the pot's value and printing it (together with its voltage) to the terminal through the USB port.<br /><br /><script src="https://gist.github.com/faif/6099348.js?file=voltmeter.cpp"></script><br /><br /><h3 style="text-align: left;">Demo</h3><div style="text-align: left;">I'm on a GNU/Linux system, where the mbed is identified as <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">/dev/ttyACM0</span>. A simple tool to use for connecting with it is <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">screen</span> (eg. <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">sudo screen /dev/ttyACM0</span>). Pardon me for the bad quality of the video, it's the first time that I used YouTube capture with my phone and it didn't work as well as I expected :)</div><div style="text-align: left;"><br /></div><iframe allowfullscreen="" frameborder="0" height="315" src="//www.youtube-nocookie.com/embed/Z-bx2zrV7SE?rel=0" width="560"></iframe> <br /><h3 style="text-align: left;">&nbsp;</h3><h3 style="text-align: left;">Acknowledgements</h3><div style="text-align: left;">Special thanks to my good friend and Arduino hacker <a href="http://efxa.org/">efxa</a>, for without his parts it wouldn't be possible to play with mbed.</div><div style="text-align: left;"><br /></div><h3 style="text-align: left;">References </h3><ul style="text-align: left;"><li><i>Bert Van Dam.</i> <a href="http://www.elektor.com/products/books/microcontrollers/arm-microcontrollers-1-%28uk%29.1625568.lynkx">ARM Microcontrollers part 1 </a></li><li><i>mbed handbook. </i><a href="https://mbed.org/handbook/SerialPC">Serial Communication with a PC</a></li></ul></div>